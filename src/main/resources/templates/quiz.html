<!DOCTYPE html>
<html>
<head>
    <title>Simple Quiz</title>
</head>
<body>
    <h1>Quiz</h1>
    <div id="quiz-container"></div>
    <button id="submit-btn">Submit Answer</button>
    <div id="result"></div>

    <script>
        let questions = [];
        let currentQuestionIndex = 0;
        let selectedAnswer = null;

        async function loadQuestions() {
            const response = await fetch('/api/quiz/questions');
            questions = await response.json();
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex >= questions.length) {
                document.getElementById('quiz-container').innerHTML = "<h2>Quiz completed!</h2>";
                document.getElementById('submit-btn').disabled = true;
                return;
            }
            const question = questions[currentQuestionIndex];
            let html = `<h3>${question.text}</h3>`;
            html += question.options.map((opt, i) =>
                `<div>
                    <input type="radio" name="answer" value="${i}" id="opt${i}">
                    <label for="opt${i}">${opt}</label>
                </div>`
            ).join('');
            document.getElementById('quiz-container').innerHTML = html;

            document.querySelectorAll('input[name="answer"]').forEach(input => {
                input.addEventListener('change', () => {
                    selectedAnswer = parseInt(input.value);
                });
            });
        }

        async function submitAnswer() {
            if (selectedAnswer === null) {
                alert("Please select an answer.");
                return;
            }

            const questionId = questions[currentQuestionIndex].id;
            const response = await fetch('/api/quiz/answer', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ questionId, answerIndex: selectedAnswer })
            });
            const result = await response.json();
            document.getElementById('result').textContent = result.correct ? "Correct!" : "Wrong!";
            currentQuestionIndex++;
            selectedAnswer = null;

            setTimeout(() => {
                document.getElementById('result').textContent = "";
                showQuestion();
            }, 1500);
        }

        document.getElementById('submit-btn').addEventListener('click', submitAnswer);

        loadQuestions();
    </script>
</body>
</html>
